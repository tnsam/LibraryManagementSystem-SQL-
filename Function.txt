CREATE OR REPLACE FUNCTION FUN_VALIDATE_BORROWERID (IN_borrowerID IN BORROWER.borrowerID%TYPE)
RETURN BOOLEAN IS
	BORROWER_EXIST BOOLEAN := TRUE;
	v_borrowerID BORROWER.borrowerID%TYPE;
BEGIN
	SELECT borrowerID into v_borrowerID
	FROM BORROWER
	WHERE borrowerID = IN_borrowerID;  

	BORROWER_EXIST := TRUE;
	RETURN BORROWER_EXIST;

EXCEPTION
        WHEN NO_DATA_FOUND 
        THEN
                BORROWER_EXIST := FALSE;
		RETURN BORROWER_EXIST;

 END;
/

CREATE OR REPLACE FUNCTION FUN_VALIDATE_ISBN (IN_ISBN IN BOOK.ISBN%TYPE)
RETURN BOOLEAN IS
	BOOK_EXIST BOOLEAN := TRUE;
	v_ISBN BOOK.ISBN%TYPE;
BEGIN
	SELECT ISBN into v_ISBN
	FROM BOOK
	WHERE ISBN = IN_ISBN;  

	BOOK_EXIST := TRUE;
	RETURN BOOK_EXIST;

EXCEPTION
        WHEN NO_DATA_FOUND 
        THEN
                BOOK_EXIST := FALSE;
		RETURN BOOK_EXIST;

 END;
/

CREATE OR REPLACE FUNCTION FUN_VALIDATE_STAFFID (IN_staffID IN STAFF.staffID%TYPE)
RETURN BOOLEAN IS
	STAFF_EXIST BOOLEAN := TRUE;
	v_staffID STAFF.staffID%TYPE;
BEGIN
	SELECT staffID into v_staffID
	FROM STAFF
	WHERE staffID = IN_staffID;  

	STAFF_EXIST := TRUE;
	RETURN STAFF_EXIST;

EXCEPTION
        WHEN NO_DATA_FOUND 
        THEN
                STAFF_EXIST := FALSE;
		RETURN STAFF_EXIST;

 END;
/


CREATE OR REPLACE FUNCTION FUNC_GET_RETURNDATE(startDate IN BORROWER_TRANS.bStartDate%TYPE, inputBorrowerID IN BORROWER.borrowerID%TYPE)
RETURN BORROWER_TRANS.returnDate%TYPE IS
	v_returnDate BORROWER_TRANS.returnDate%TYPE;
	v_duration BORROWER_TYPE.maxBorrowDuration%TYPE;
BEGIN
	SELECT maxBorrowDuration INTO v_duration
	FROM BORROWER B, BORROWER_TYPE BT
	WHERE B.borrowerID = inputBorrowerID AND
	      B.borrowerTypeID = BT.borrowerTypeID;

	v_returnDate := startDate + v_duration;
	RETURN v_returnDate;

END;
/

CREATE OR REPLACE FUNCTION FUNC_DAY_DIFFERENCE(inputDate IN DATE)
RETURN NUMBER IS
	v_day_difference NUMBER;
BEGIN
	v_day_difference := TRUNC(SYSDATE) - inputDate;
	RETURN v_day_difference;

END;
/

CREATE OR REPLACE FUNCTION FUNC_LATE_RETURN_FINES(dayDiff IN NUMBER)
RETURN BORROWER_TRANS.FINESAMT%TYPE IS
	totalAmt BORROWER_TRANS.FINESAMT%TYPE;
BEGIN
	totalAmt := dayDiff * 0.5;
	RETURN totalAmt;

END;
/

CREATE OR REPLACE FUNCTION FUNC_BOOK_LOST_FINES(inputISBN IN BOOK.ISBN%TYPE)
RETURN BORROWER_TRANS.FINESAMT%TYPE IS
	totalAmt BORROWER_TRANS.FINESAMT%TYPE;
	v_bookPrice BOOK.bookPrice%TYPE;
BEGIN
	SELECT bookPrice INTO v_bookPrice
	FROM BOOK 
	WHERE ISBN = inputISBN;

	totalAmt := v_bookPrice * 2;
	RETURN totalAmt;

END;
/
